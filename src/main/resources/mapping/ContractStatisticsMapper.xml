<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.upc.manage.dao.ContractStatisticsMapper">
    <resultMap id="BaseResultMap" type="cn.edu.upc.manage.model.ContractStatistics">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 25 11:20:11 CST 2020.
        -->
        <id column="project_id" jdbcType="INTEGER" property="projectId" />
        <result column="signed_num" jdbcType="INTEGER" property="signedNum" />
        <result column="signed_money" jdbcType="VARCHAR" property="signedMoney" />
        <result column="unsigned_num" jdbcType="INTEGER" property="unsignedNum" />
        <result column="unsigned_money" jdbcType="REAL" property="unsignedMoney" />
        <result column="project_name" jdbcType="VARCHAR" property="projectName" />

    </resultMap>

    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Jun 25 15:34:11 CST 2020.
        -->
         project_id,signed_num,signed_money,unsigned_num,unsigned_money,project_name
    </sql>

    <select id="getContractStatistics" resultMap="BaseResultMap">
        select a.*,b.unsigned_num,b.unsigned_money,c.project_name from
(select project_id,count(*)as signed_num,sum(contrscy_money)as signed_money from contract_information where project_id=#{projectId} and del_flag=0) as a
LEFT JOIN(select project_id,count(*)as unsigned_num,sum(bid_money) as unsigned_money from tender_information where del_flag=0 and project_id=#{projectId} and id not in(select tender_id from contract_tender_relation))as b on a.project_id=b.project_id
LEFT JOIN(select id,project_name from project_store)as c on c.id=a.project_id
    </select>

</mapper>